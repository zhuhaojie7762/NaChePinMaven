<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="carlist_content-Type" carlist_content="text/html; charset=utf-8"/>
    <meta name="viewport" carlist_content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
    <title>我的退款退货</title>
    <link href="/static/images/web/ncp_logo.ico" rel="icon" type="image/x-icon"/>
    <link href="/static/images/web/ncp_logo.ico" rel="shortcut icon" type="image/x-icon"/>
    <link rel="stylesheet" type="text/css" href="/static/css/web/common.css?v=${v}">
    <link rel="stylesheet" type="text/css" href="/static/css/web/style.css?v=${v}">
    <link rel="stylesheet" type="text/css" href="/static/css/web/jindutiao.css?v=${v}">
    <script type="text/javascript" src="/static/js/web/jquery-1.9.1.min.js?v=${v}"></script>
    <script type="text/javascript" src="/static/js/web/zixie.js?v=${v}"></script>
    <script type="text/javascript" src="/static/js/web/baidu.js?v=${v}"></script>
    <script type="text/javascript" src="/static/js/web/file.js?v=${v}"></script>
    <script type="text/javascript" src="http://g.alicdn.com/sj/lib/jquery/dist/jquery.min.js?v=${v}"></script>
    <script type="text/javascript" src="http://g.alicdn.com/sj/dpl/1.5.1/js/sui.min.js?v=${v}"></script>
    <link rel="stylesheet" type="text/css" href="/static/css/web/sui.min.css?v=${v}">
    <link rel="stylesheet" type="text/css" href="/static/css/web/sui-append.css?v=${v}">
    <link rel="stylesheet" type="text/css" href="/static/css/web/webuploader.css?v=${v}">
    <script type="text/javascript" src="/static/js/MsgBox.js?v=${v}"></script>
    <link rel="stylesheet" type="text/css" href="/static/css/msg_box.css?v=${v}">
    <script type="text/javascript" src="/static/js/common.js?v=${v}"></script>
    <style>
        .sui-dropup .caret::before, .sui-dropdown .caret::before{ content: "";}
        .sui-dropup.dropdown-bordered .dropdown-inner a, .sui-dropdown.dropdown-bordered .dropdown-inner a{min-width: 143px;color:#999;}
        .dropdown-inner {
            background: rgba(0, 0, 0, 0) url("/static/images/web/xialabg.png") no-repeat scroll 138px center;
        }
        .sui-dropup.dropdown-bordered .dropdown-inner > .sui-dropdown-menu, .sui-dropdown.dropdown-bordered .dropdown-inner > .sui-dropdown-menu {
            margin: 0 0 0 65px;
            min-width: 98%;
        }
        .sui-dropup.dropdown-bordered > .dropdown-inner > .sui-dropdown-menu, .sui-dropdown.dropdown-bordered > .dropdown-inner > .sui-dropdown-menu {
            left: -62px;
        }
        .ttlog_search{padding-top:1px;}
        .sui-dropup.dropdown-bordered .dropdown-inner, .sui-dropdown.dropdown-bordered .dropdown-inner {
            border-radius: 0;
            border:1px solid #ddd;
        }
        .sui-dropup.dropdown-bordered, .sui-dropdown.dropdown-bordered{line-height: 19px;}
        .chaxunquyu{position: absolute;top:185px;left:253px;}
        #chaxun .add_shouxing,#chaxun .daycha{cursor: pointer;color:#169bd5;}
        #chaxun .daycha{margin:0 12px;}
        #add_mywuliu .ncjhs_p001 span input[type="text"],#add_mywuliu .ncjhs_p001 span input.ncjhs_inputxZ[type="text"] {
            padding: 6px 15px;
            width: 130px;
            color:#444;
        }
        #add_mywuliu textarea{width: 500px;border:1px solid #f0f0f0;height: 50px;padding:10px;color:#666;font-size: 12px;}
        .zuixin_okbtn{width:100%;height: 20px;}
        #zuixiwuliu p{text-align: left;}
        #zuixiwuliu p.ncnum_tcTitle{text-align: center;}
        #zuixiwuliu .ncnum_updateBtn{margin-left:116px;}
    </style>
</head>
<%layout("../../layout/body_layout.html"){%>
<div class="zx_type">
    <div class="zx_arrow"></div>
    我的退款退货
</div>
<p class="zx_grzxUser"><span class="indTitleTao"></span>我的退款退货</p>
<fieldset id="ddmlF">
    <legend>查询信息</legend>
    <form action="/member/buyerDispute/buyerDisputeList.html" name="refundQuery" method="post">
        <input type="hidden" name="preview" value="true" />
        <p class="ttlog_search">
            <span>总订单编号：</span>
        <span>
            <input type="text" class="ttlog_input" style="width: 80px;" onblur="javascript:this.className='ttlog_input'" onfocus="javascript:this.className='ttlog_input02'" value="${params.tradeId!}" name="tradeId" />
        </span>
            <span>&nbsp;&nbsp;子订单编号：</span>
        <span>
            <input type="text" class="ttlog_input" style="width: 80px;" onblur="javascript:this.className='ttlog_input'" onfocus="javascript:this.className='ttlog_input02'" value="${params.code!}" name="code" />
        </span>
            <span>&nbsp;&nbsp;货品货号：</span>
        <span>
            <input type="text" class="ttlog_input" style="width: 80px;" onblur="javascript:this.className='ttlog_input'" onfocus="javascript:this.className='ttlog_input02'" value="${params.goods!}" name="goods" />
        </span>
        <span class="span001">&nbsp;&nbsp;退货状态：</span>
        <div class="add_gudingwz" id="tui_handk">
            <div class="ty_gyClear"></div>
            <span class="sui-dropdown dropdown-bordered select">
                <span class="dropdown-inner add_xiala">
                    <a id="wuliu" role="button" data-toggle="dropdown" href="#" class="dropdown-toggle">
                        <input name="status" value="${params.status!}" type="hidden"><i class="caret"></i>
                        <span>
                            <%if(params.status == "70"){%>
                                退货
                            <%}else if(params.status == "105"){%>
                                退款
                            <%}else if(params.status == "120"){%>
                                取消退货
                            <%}else if(params.status == "122"){%>
                                取消退款
                            <%}else{%>
                                请选择退款状态
                            <%}%>
                        </span>
                    </a>
                    <ul id="wuliuCon" role="menu" aria-labelledby="wuliu" class="sui-dropdown-menu">
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0);" value="" title="请选择退款状态">请选择退款状态</a></li>
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0);" value="70" title="退货">已申请退货</a></li>
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0);" value="105" title="退款">已申请退款</a></li>
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0);" value="120" title="取消退货">已取消退货</a></li>
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0);" value="122" title="取消退款">已取消退款</a></li>
                    </ul>
                </span>
            </span>
        </div>
        </p>
        <div class="ty_gyClear"></div>
        <p id="chaxun" class="ttlog_search">
            <span style="margin-left:9px;">下单时间：</span>
            <span id="demo2" class="date float_l">
                <span class="add-on">&nbsp;</span>
                <input type="text" name="startCreated" value="${params.startCreated!}" style="width: 80px;" class="ttlog_input" onfocus="javascript:this.className='ttlog_input02'" onblur="javascript:this.className='ttlog_input'">
            </span>
            <script type="text/javascript">
                $('#demo2.date').datepicker({});
            </script>
            <span id="demo" class="date float_l">
                <span class="add-on">至</span>
                <input type="text" name="endCreated" value="${params.endCreated!}" style="width: 80px;"  class="ttlog_input" onfocus="javascript:this.className='ttlog_input02'" onblur="javascript:this.className='ttlog_input'">
            </span>
            <script type="text/javascript">
                $('#demo.date').datepicker({});
            </script>

            <span style="margin-left:9px;">退款申请时间：</span>
            <span id="demo3" class="date float_l">
                <span class="add-on">&nbsp;</span>
                <input type="text" name="startRefund" value="${params.startRefund!}" style="width: 80px;" class="ttlog_input" onfocus="javascript:this.className='ttlog_input02'" onblur="javascript:this.className='ttlog_input'">
            </span>
            <script type="text/javascript">
                $('#demo3.date').datepicker({});
            </script>
            <span id="demo4" class="date float_l">
                <span class="add-on">至</span>
                <input type="text" name="endRefund" value="${params.endRefund!}" style="width: 80px;"  class="ttlog_input" onfocus="javascript:this.className='ttlog_input02'" onblur="javascript:this.className='ttlog_input'">
            </span>
            <script type="text/javascript">
                $('#demo4.date').datepicker({});
            </script>
        </p>
        <div class="chaxunquyu" id="chabtn">
            <span><input type="button" class="ttLog_chaXun" onclick="refundQuery.submit();" title="查询" value="&nbsp;&nbsp;查询&nbsp;&nbsp;" /> </span>
            <span><input type="button" class="ttLog_chongzhi" onclick="resetForm()" value="&nbsp;&nbsp;重置&nbsp;&nbsp;"/></span>
        </div>
    </form>
</fieldset>
<div class="ty_gyClear"></div>
<!-- 我的退款退货信息 -->
<table class="sui-table table-bordered" id="tuihuokuan_dingdan">
    <thead>
    <th width="170">商品信息</th>
    <th width="80">交易金额</th>
    <th width="80">退款金额</th>
    <th width="80">申请时间</th>
    <th width="80">状态</th>
    <th width="90">操作</th>
    </thead>
    <tbody>
    <%for(order in orders.data){%>
    <tr>
        <td colspan="6" class="add_bgColor">
            <span>总订单编号：${order.TradeCode!}</span>
            <span class="add_xiadantime">子订单编号：${order.code!}</span>
        </td>
    </tr>
    <tr>
        <td>
            <div class="add_shopxqing add_shijiwidth">
                <a href="" target="_blank">
                    <dl>
                        <dt><img src="${img_url.getS(order.goods.headImgUrl1)}" width="70" /></dt>
                        <dd class="title">${order.goodsName!}</dd>
                        <dd class="huohao">商品货号：${order.goodsItemNo!}</dd>
                        <dd class="huohao">规格:${order.specPropValue!}</dd>
                    </dl>
                </a>
            </div>
        </td>
        <td>${nums.yuan(order.money)}</td>
        <td>${nums.yuan(order.refundFee)}</td>
        <td class="add_tdnoborder">${order.applyRefundTime, "yyyy-MM-dd HH:mm"}</td>
        <td class="add_tdnoborder">
            ${order.status.name!}
        </td>
        <td class="ncguanzhu_chaK02 add_tdnoborder">
            <a href="goBuyerDisputeDetail?code=${order.code!}">查看详情</a>
            <div class="ty_gyClearat"></div>
            <%if(order.cancelRefundFlag == 0){%>
                <%if(order.orderStatus.val >= 50 && order.orderStatus.val < 200){%>
                    <a href="javascript:;" onclick="cancel('${order.code!}');">取消申请</a>
                <%}%>
            <%}%>
            <div class="ty_gyClearat"></div>
            <%if(order.status.val == 70 || order.status.val == 75 || order.status.val == 105 || order.status.val == 110){%>
                <%if(isNotEmpty(order.applyRefundFlag)){%>
                    <%if(order.applyRefundFlag.val == 105){%>
                        <a href="/member/buyerDisputeEdit/refundEdit?code=${order.code!}">修改申请</a>
                    <%}%>
                    <%if(order.applyRefundFlag.val == 70){%>
                        <a href="/member/buyerDisputeEdit/refundGoodsEdit?code=${order.code!}">修改申请</a>
                    <%}%>
                <%}%>
            <%}%>
            <%if(order.status.val == 80){%>
                <a href="javascript:;" data-toggle="modal" data-target="#zuixiwuliu" data-keyboard="false">填写物流信息</a>
                <div id="zuixiwuliu" tabindex="-1" role="dialog" data-hasfoot="false" class="sui-modCity hide fade">
                    <div class="zdCity_Con">
                        <button type="button" data-dismiss="modal" aria-hidden="true" class="sui-close">×</button>
                        <form action="editPwd" class="form-editPwd sui-validate" method="post">
                            <p class="ncnum_tcTitle">物流信息</p>
                            <p class="ncnum_tcinp">
                                <span class="ncnum_spanL">物流公司</span>
                                <span><input type="text" class="ncnum_pwd" id="trackingName" data-rules='required' /></span>
                            </p>
                            <p class="ncnum_tcinp">
                                <span class="ncnum_spanL">物流单号</span>
                                <span><input type="text" class="ncnum_pwd" id="trackingNumber" data-rules='required' /></span>
                            </p>
                            <div class="zuixin_okbtn"></div>
                            <p class="ncnum_tcinp">
                                <input type="button" class="ncnum_updateBtn" onclick="doTracking('${order.code!}');" value="提交物流信息" />
                            </p>
                        </form>
                    </div>
                </div>
            <%}%>
            <div class="ty_gyClear"></div>
        </td>
    </tr>
    <%}elsefor{%>
    <tr>
        <td colspan="6" class="zanWuShuju"><p>暂无数据</p></td>
    </tr>
    <%}%>
    </tbody>
</table>
<#webPage val='${orders.page}' size='large' params = '${params!}' showNum = 'hide' />
<!-- /我的退款退货信息 -->
<script>
$(function() {
    Pagination.init();
});
function cancel(code) {
    var request = $.ajax({
        url: "cancel?code=" + code,
        dataType: "json"
    });

    request.done(function(result) {
        if (result.code == Common.SUCC) {
            Msg.success(result.message);
            setTimeout(function() {
                Common.go("/member/buyerDispute/buyerDisputeList.html");
            }, 2000);
        } else {
            Msg.danger(result.message);
        }
    });
}
function doTracking(code) {
    var trackingName = $.trim($('#trackingName').val());
    var trackingNumber = $.trim($('#trackingNumber').val());
    if (trackingName.length == 0 || trackingNumber.length == 0) {
        return;
    }

    var request = $.ajax({
        url: "trackingSave?code=" + code,
        data: { "code" : code, "trackingName" : trackingName, "trackingNumber" : trackingNumber },
        dataType: "json"
    });

    request.done(function(result) {
        if (result.code == Common.SUCC) {
            Msg.success(result.message);
            setTimeout(function() {
                Common.go("/member/buyerDispute/buyerDisputeList.html");
            }, 2000);
        } else {
            Msg.danger(result.message);
        }
    });
}
</script>
<%}%>
</html>
