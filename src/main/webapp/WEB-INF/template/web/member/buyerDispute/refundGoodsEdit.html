<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="carlist_content-Type" carlist_content="text/html; charset=utf-8"/>
    <meta name="viewport" carlist_content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
    <title>退货申请修改</title>
    <link href="/static/images/web/ncp_logo.ico" rel="icon" type="image/x-icon"/>
    <link href="/static/images/web/ncp_logo.ico" rel="shortcut icon" type="image/x-icon"/>
    <link rel="stylesheet" type="text/css" href="/static/css/web/common.css?v=${v}">
    <link rel="stylesheet" type="text/css" href="/static/css/web/style.css?v=${v}">
    <link rel="stylesheet" type="text/css" href="/static/css/web/jindutiao.css?v=${v}">
    <link rel="stylesheet" type="text/css" href="/static/css/web/sui.min.css?v=${v}">
    <link rel="stylesheet" type="text/css" href="/static/css/web/sui-append.css?v=${v}">
    <link rel="stylesheet" type="text/css" href="/static/css/msg_box.css?v=${v}">
    <script type="text/javascript" src="/static/js/web/jquery-1.9.1.min.js?v=${v}"></script>
    <script type="text/javascript" src="/static/js/web/zixie.js?v=${v}"></script>
    <script type="text/javascript" src="/static/js/web/baidu.js?v=${v}"></script>
    <script type="text/javascript" src="/static/js/web/file.js?v=${v}"></script>
    <script type="text/javascript" src="http://g.alicdn.com/sj/lib/jquery/dist/jquery.min.js?v=${v}"></script>
    <script type="text/javascript" src="http://g.alicdn.com/sj/dpl/1.5.1/js/sui.min.js?v=${v}"></script>
    <script type="text/javascript" src="/static/js/MsgBox.js?v=${v}"></script>
    <!--添加规格 start -->
    <script type="text/javascript" src="/static/js/web/liandong.js?v=${v}"></script>
    <!--添加规格 end -->
    <!-- 一次性上传多个图片 start -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js?v=${v}"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js?v=${v}"></script>
    <![endif]-->
    <script type="text/javascript" src="/static/js/common.js?v=${v}"></script>
    <script type="text/javascript" src="/static/js/jquery.form.js?v=${v}"></script>
    <style>
        .sui-dropup .caret::before, .sui-dropdown .caret::before{ content: "";}
        .sui-dropup.dropdown-bordered .dropdown-inner a, .sui-dropdown.dropdown-bordered .dropdown-inner a{min-width: 143px;color:#999;}
        .dropdown-inner {
            background: rgba(0, 0, 0, 0) url("/static/images/web/xialabg.png") no-repeat scroll 138px center;
        }
        .sui-dropup.dropdown-bordered .dropdown-inner > .sui-dropdown-menu, .sui-dropdown.dropdown-bordered .dropdown-inner > .sui-dropdown-menu {
            margin: 0 0 0 65px;
            min-width: 98%;
        }
        .sui-dropup.dropdown-bordered > .dropdown-inner > .sui-dropdown-menu, .sui-dropdown.dropdown-bordered > .dropdown-inner > .sui-dropdown-menu {
            left: -62px;
        }
        .ttlog_search{padding-top:1px;}
        .sui-dropup.dropdown-bordered .dropdown-inner, .sui-dropdown.dropdown-bordered .dropdown-inner {
            border-radius: 0;
            border:1px solid #ddd;
        }
        .sui-dropup.dropdown-bordered, .sui-dropdown.dropdown-bordered{line-height: 19px;}
        .chaxunquyu{position: absolute;top:185px;left:253px;}
        #chaxun .add_shouxing,#chaxun .daycha{cursor: pointer;color:#169bd5;}
        #chaxun .daycha{margin:0 12px;}
        #ddmlF{height: 190px;}
        #add_mywuliu .ncjhs_p001 span input[type="text"],#add_mywuliu .ncjhs_p001 span input.ncjhs_inputxZ[type="text"] { padding: 6px 15px;width: 130px;color:#444;}
        /*zuixin add start*/
        #add_mywuliu textarea{width: 800px;border:1px solid #f0f0f0;height: 50px;padding:10px;color:#666;font-size: 12px;color:#999;}
        #add_mywuliu input#refundAmount{width: 230px;color:#999;}
        #add_mywuliu span.add_zuicin{font-size:12px;margin-left:15px;}
        .sui-dropup.dropdown-bordered .dropdown-inner > .sui-dropdown-menu, .sui-dropdown.dropdown-bordered .dropdown-inner > .sui-dropdown-menu{max-height: 160px;}
        .sui-dropup.dropdown-bordered > .dropdown-inner > .sui-dropdown-menu, .sui-dropdown.dropdown-bordered > .dropdown-inner > .sui-dropdown-menu{left:-65px;}
        .sui-dropup.dropdown-bordered .dropdown-inner > .sui-dropdown-menu, .sui-dropdown.dropdown-bordered .dropdown-inner > .sui-dropdown-menu{min-width: 100%;}
        /*zuixin add end*/
    </style>
</head>
<%layout("../../layout/body_layout.html"){%>
<div class="zx_type">
    <div class="zx_arrow"></div>
    退货申请修改
</div>
<p class="zx_grzxUser"><span class="indTitleTao"></span>退货申请修改</p>
<!-- 退货商品详情 -->
<table class="sui-table table-bordered" id="add_xiangq02">
    <thead>
    <th>货品详情</th>
    <th>规格属性</th>
    <th>单价</th>
    <th>数量</th>
    <th>商品金额</th>
    <th>邮费</th>
    <th>状态</th>
    </thead>
    <tbody>
    <tr>
        <td>
            <dl>
                <dt><img src="${img_url.getS(goods.headImgUrl1)}" width="60" /></dt>
                <dd>${goods.brand!}&nbsp;&nbsp;${goods.name!}</dd>
            </dl>
        </td>
        <td>${order.specPropValue!}</td>
        <td>${nums.yuan(goods.wholesalePrice)}</td>
        <td>${order.quantity!}</td>
        <td>${nums.yuan(order.money)}</td>
        <td>${nums.yuan(trade.postFee)}</td>
        <td>${order.status.name!}</td>
    </tr>
    </tbody>
</table>
<!-- /退货商品详情 -->
<fieldset id="add_mywuliu">
    <!-- 退货申请提交 -->
    <legend>退货申请信息</legend>
    <form action="/member/buyerDisputeEdit/doRefundGoodsEdit" id="doRefundGoodsEdit" enctype="multipart/form-data" method="post">
    <input type="hidden" name="orderCode" value="${order.code!}" />
    <p class="add_pspan add_marTop">
        <span class="span001">退货原因：</span>
    <div class="add_gudingwz">
        <div class="ty_gyClear"></div>
            <span class="sui-dropdown dropdown-bordered select">
                <span class="dropdown-inner add_xiala">
                    <a id="wuliu" role="button" data-toggle="dropdown" href="#" class="dropdown-toggle">
                        <input type="hidden" name="refundCause" value="${reason.refundReason!}" /><i class="caret"></i>
                        <span>${reason.refundReason!}</span>
                    </a>
                    <ul id="wuliuCon" role="menu" aria-labelledby="wuliu" class="sui-dropdown-menu">
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0);" value="我不想要了" title="我不想要了">我不想要了</a></li>
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0);" value="退运费" title="退运费">退运费</a></li>
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0);" value="做工粗糙/有瑕疵" title="做工粗糙/有瑕疵">做工粗糙/有瑕疵</a></li>
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0);" value="质量有问题" title="质量有问题">质量有问题</a></li>
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0);" value="大小/尺寸与商品描述不符" title="大小/尺寸与商品描述不符">大小/尺寸与商品描述不符</a></li>
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0);" value="颜色/图案/款式与商品描述不符" title="颜色/图案/款式与商品描述不符">颜色/图案/款式与商品描述不符</a></li>
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0);" value="材质与商品描述不符" title="材质与商品描述不符">材质与商品描述不符</a></li>
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0);" value="少件（含缺少配件）" title="少件（含缺少配件）">少件（含缺少配件）</a></li>
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0);" value="卖家发错货" title="卖家发错货">卖家发错货</a></li>
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0);" value="收到商品时有破损/污渍/变形" title="收到商品时有破损/污渍/变形">收到商品时有破损/污渍/变形</a></li>
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0);" value="假冒品牌" title="假冒品牌">假冒品牌</a></li>
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0);" value="未按约定时间发货" title="qqqq">未按约定时间发货</a></li>
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0);" value="发票问题" title="发票问题">发票问题</a></li>
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0);" value="其它原因" title="其它原因">其它原因</a></li>
                    </ul>
                </span>
            </span>
        </div>
    </p>
    <p class="add_pspan add_marTop ncjhs_p001">
        <span class="span001">退款金额：</span>
        <span>
            <input type="text" name="refundAmount" id="refundAmount" maxlength="20" placeholder="最大退款金额" value="${nums.yuan(order.refundFee)}" onkeyup="value=value.replace(/[^\d.]/g,'')" />
        </span>
        <span class="add_zuicin">
            退款金额明细 <font color="red">${detailPrice!}</font> 元（商品金额-优惠卷比例金额+运费= 退款金额）
        </span>
    </p>
    <p class="add_pspan add_marTop ncjhs_p001 add_inputheight">
        <span class="span001">退货说明：</span>
        <span>
            <textarea name="refundExplain" id="refundExplain" oninput="value=value.slice(0,200)" placeholder="0~200字以内">${reason.remarkReason!}</textarea>
        </span>
    </p>
    <div class="ty_gyClear"></div>

    <span class="add_hdysys">图片信息：</span>
    <fieldset>
        <div class="ncp_uploadPic">
            <div class="ncp_uploadP01">
                <input type="hidden" name="refundImg" id="refundImg01" value="${imgMap.refundImg1!}" />
                <input type="file" name="refundImgUrl1" title="点击图片重新上传" class="ncp_picImg" accept=".jpg,.jpeg,.gif,.bmp" onchange="checkImageSize(this, '01')" />
                <div  id="preview01" class="ncp_picDiv">
                    <img id="imghead01" border="0" src="${isEmpty(img_url.fullPath(imgMap.refundImg1))?'/static/images/web/ncp_upload.png': img_url.getS(imgMap.refundImg1)}" width="198" height="198" />
                </div>
            </div>
            <div class="ncp_uploadP02">
                <input type="hidden" name="refundImg" id="refundImg02" value="${imgMap.refundImg2!}" />
                <input type="file" name="refundImgUrl2" title="点击图片重新上传" class="ncp_picImg" accept=".jpg,.jpeg,.gif,.bmp" onchange="checkImageSize(this, '02')" />
                <div  id="preview02" class="ncp_picDiv">
                    <img id="imghead02" border="0" src="${isEmpty(img_url.fullPath(imgMap.refundImg2))?'/static/images/web/ncp_upload.png':img_url.getS(imgMap.refundImg2)}" width="198" height="198" />
                </div>
            </div>
            <div class="ncp_uploadP03">
                <input type="hidden" name="refundImg" id="refundImg03" value="${imgMap.refundImg3!}" />
                <input type="file" name="refundImgUrl3" title="点击图片重新上传" class="ncp_picImg" accept=".jpg,.jpeg,.gif,.bmp" onchange="checkImageSize(this, '03')" />
                <div  id="preview03" class="ncp_picDiv">
                    <img id="imghead03" border="0" src="${isEmpty(img_url.fullPath(imgMap.refundImg3))?'/static/images/web/ncp_upload.png':img_url.getS(imgMap.refundImg3)}" width="198" height="198" />
                </div>
            </div>
            <div class="ncp_uploadP04">
                <input type="hidden" name="refundImg" id="refundImg04" value="${imgMap.refundImg4!}" />
                <input type="file" name="refundImgUrl4" title="点击图片重新上传" class="ncp_picImg" accept=".jpg,.jpeg,.gif,.bmp" onchange="checkImageSize(this, '04')" />
                <div  id="preview04" class="ncp_picDiv">
                    <img id="imghead04" border="0" src="${isEmpty(img_url.fullPath(imgMap.refundImg4))?'/static/images/web/ncp_upload.png':img_url.getS(imgMap.refundImg4)}" width="198" height="198" />
                </div>
            </div>
            <div class="ncp_uploadP05">
                <input type="hidden" name="refundImg" id="refundImg05" value="${imgMap.refundImg5!}" />
                <input type="file" name="refundImgUrl5" title="点击图片重新上传" class="ncp_picImg" accept=".jpg,.jpeg,.gif,.bmp" onchange="checkImageSize(this, '05')" />
                <div  id="preview05" class="ncp_picDiv">
                    <img id="imghead05" border="0" src="${isEmpty(img_url.fullPath(imgMap.refundImg5))?'/static/images/web/ncp_upload.png':img_url.getS(imgMap.refundImg5)}" width="198" height="198" />
                </div>
            </div>
        </div>
    </fieldset>

    <p class="add_twobtns">
        <input type="button" class="ttLog_chaXun add_ncptijiao" value="修改" />
        <input type="button" class="ttLog_chongzhi add_ncpquxiao" value="取消" />
    </p>
    </form>
    <!-- /退货申请提交 -->
</fieldset>
<script>
    $(function () {
        Common.ajaxForm($("form#doRefundGoodsEdit"), null, function(result){
            var flag = true;
            for (var i = 1; i <= 5; i++) {
                var fileName = $('#imghead0' + i)[0].src.substring($('#imghead0' + i)[0].src.lastIndexOf('/'));
                if (fileName != '/ncp_upload.png') {
                    flag = false;
                    break;
                }
            }
            if (flag) {
                if (dateFunc.coerceImg($('input[name=refundCause]').val())) {
                    return;
                }
            }

            if(result.code == Common.SUCC){
                Msg.success(result.message);
                setTimeout(function() {
                    Common.go("/member/buyerDispute/buyerDisputeList.html");
                }, 2000);
            }else{
                Msg.danger(result.message);
            }
        });
        $('.add_ncptijiao').click(function () {
            $("form#doRefundGoodsEdit").submit();
        });

        $('.add_ncpquxiao').click(function() {
            Common.go("/member/buyerDispute/buyerDisputeList.html");
        });
    });

    function previewImage(file, type)
    {
        $('#refundImg' + type).val("");
        var MAXWIDTH  = 198;
        var MAXHEIGHT = 198;
        var div = document.getElementById('preview' + type);
        if (file.files && file.files[0])
        {
            div.innerHTML ='<img id=imghead' + type + '>';
            var img = document.getElementById('imghead' + type);
            img.onload = function(){
                var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
                img.width  =  rect.width;
                img.height =  rect.height;
                img.style.marginTop = rect.top+'px';
            }
            var reader = new FileReader();
            reader.onload = function(evt){img.src = evt.target.result;}
            reader.readAsDataURL(file.files[0]);
        }
        else //兼容IE
        {
            var sFilter='filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="';
            file.select();
            var src = document.selection.createRange().text;
            div.innerHTML = '<img id=imghead' + type + '>';
            var img = document.getElementById('imghead' + type);
            img.filters.item('DXImageTransform.Microsoft.AlphaImageLoader').src = src;
            var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
            status =('rect:'+rect.top+','+rect.left+','+rect.width+','+rect.height);
            div.innerHTML = "<div id=divhead"+ type + " style='width:"+rect.width+"px;height:"+rect.height+"px;margin-top:"+rect.top+"px;"+sFilter+src+"\"'></div>";
        }
    }

    function clacImgZoomParam( maxWidth, maxHeight, width, height ){
        var param = {top:0, left:0, width:width, height:height};
        if( width>maxWidth || height>maxHeight )
        {
            rateWidth = width / maxWidth;
            rateHeight = height / maxHeight;

            if( rateWidth > rateHeight )
            {
                param.width =  maxWidth;
                param.height = Math.round(height / rateWidth);
            }else
            {
                param.width = Math.round(width / rateHeight);
                param.height = maxHeight;
            }
        }
        param.left = Math.round((maxWidth - param.width) / 2);
        param.top = Math.round((maxHeight - param.height) / 2);
        return param;
    }
</script>
<%}%>
</html>
